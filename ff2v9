-- Football Fusion 2 Utility Script for Delta Executor
-- Features: Auto Catch, Magnet Catch, Anti Kick/Ban, Auto Dime (QB)
-- Menu UI with toggles for each feature

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Create UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FF2UtilityMenu"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 200)
Frame.Position = UDim2.new(0, 10, 0, 100)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.FillDirection = Enum.FillDirection.Vertical
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = Frame

local function CreateToggle(text)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(1, -20, 0, 30)
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Parent = Frame

    local Label = Instance.new("TextLabel")
    Label.Text = text
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.TextColor3 = Color3.fromRGB(220, 220, 220)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 18
    Label.Parent = ToggleFrame

    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0.3, -10, 1, -6)
    ToggleButton.Position = UDim2.new(0.7, 10, 0, 3)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
    ToggleButton.Text = "OFF"
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.TextSize = 18
    ToggleButton.TextColor3 = Color3.new(1,1,1)
    ToggleButton.Parent = ToggleFrame

    local toggled = false
    ToggleButton.MouseButton1Click:Connect(function()
        toggled = not toggled
        if toggled then
            ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
            ToggleButton.Text = "ON"
        else
            ToggleButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
            ToggleButton.Text = "OFF"
        end
    end)
    return ToggleButton, function() return toggled end
end

-- Create toggles
local autoCatchToggle, isAutoCatchOn = CreateToggle("Auto Catch")
local magCatchToggle, isMagCatchOn = CreateToggle("Magnet Catch")
local antiKickToggle, isAntiKickOn = CreateToggle("Anti Kick/Ban")
local autoDimeToggle, isAutoDimeOn = CreateToggle("Auto Dime (QB)")

-- Utility references
local Ball = workspace:WaitForChild("Football", 5)
local BallRootPart = Ball and Ball:FindFirstChild("Handle") or nil

-- Function to get closest catchable ball to player
local function GetClosestBall()
    if not BallRootPart then return nil end
    local dist = (BallRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
    if dist <= 50 then -- catch range
        return BallRootPart
    end
    return nil
end

-- Auto Catch implementation
local function AutoCatch()
    local ballPart = GetClosestBall()
    if ballPart and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        -- Use the game's catch function if exposed; else simulate catch by firing remote or setting ownership
        local remote = game.ReplicatedStorage:FindFirstChild("CatchEvent") or game.ReplicatedStorage:FindFirstChild("CatchBall")
        if remote and remote:IsA("RemoteEvent") then
            remote:FireServer(ballPart)
        end
    end
end

-- Magnet Catch: Pull ball to player
local function MagnetCatch()
    if BallRootPart and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = LocalPlayer.Character.HumanoidRootPart
        BallRootPart.CFrame = hrp.CFrame * CFrame.new(0, 3, 3)
        BallRootPart.Velocity = Vector3.new(0,0,0)
        BallRootPart.RotVelocity = Vector3.new(0,0,0)
    end
end

-- Anti Kick/Ban: Prevent kicking by overriding kick function or intercepting kick remote
local function SetupAntiKick()
    -- Hook kick remote invocation to prevent kicks
    local KickRemote = game.ReplicatedStorage:FindFirstChild("KickPlayer") or game.ReplicatedStorage:FindFirstChild("KickEvent")
    if KickRemote and KickRemote:IsA("RemoteEvent") then
        local mt = getrawmetatable(game)
        local oldNamecall = mt.__namecall
        setreadonly(mt, false)
        mt.__namecall = newcclosure(function(self, ...)
            local method = getnamecallmethod()
            local args = {...}
            if self == KickRemote and method == "FireServer" then
                if args[1] == LocalPlayer then
                    return
                end
            end
            return oldNamecall(self, ...)
        end)
        setreadonly(mt, true)
    end
end

-- Auto Dime: Auto pass for QB, simulate throwing to a teammate
local function AutoDime()
    local remotePass = game.ReplicatedStorage:FindFirstChild("ThrowBall") or game.ReplicatedStorage:FindFirstChild("PassEvent")
    if not remotePass or not (remotePass:IsA("RemoteEvent") or remotePass:IsA("RemoteFunction")) then return end

    -- Find closest teammate to throw to
    local closestTeammate = nil
    local closestDist = math.huge
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Team == LocalPlayer.Team and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local dist = (plr.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            if dist < closestDist then
                closestDist = dist
                closestTeammate = plr
            end
        end
    end

    if closestTeammate then
        if remotePass:IsA("RemoteEvent") then
            remotePass:FireServer(closestTeammate.Character.HumanoidRootPart.Position)
        elseif remotePass:IsA("RemoteFunction") then
            remotePass:InvokeServer(closestTeammate.Character.HumanoidRootPart.Position)
        end
    end
end

-- Run loops
RunService.Heartbeat:Connect(function()
    if isAntiKickOn() then
        SetupAntiKick()
    end
    if isAutoCatchOn() then
        AutoCatch()
    end
    if isMagCatchOn() then
        MagnetCatch()
    end
    if isAutoDimeOn() then
        AutoDime()
    end
end)

-- Draggable UI
local UserInputService = game:GetService("UserInputService")
local dragging, dragInput, dragStart, startPos

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

print("Football Fusion 2 Utility loaded! Use the menu to toggle features.")
